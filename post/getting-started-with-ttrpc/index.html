<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Getting started with ttrpc :: //allee</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="I believe ttrpc stands for teeny tiny rpc. Don&#39;t quote me on it. Created for low latency environments based off of the famous gRPC. I was introduced by ttrpc in a talk given by a containerD maintainer. Unexpected for you to know how containerD functions to get started with ttrpc.
This guide is aimed for developers who know gRPC and would like to get started with ttrpc. Knowledge of gRPC isn&#39;t required, however knowledge of golang and tcp is needed."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://alleeclark.github.io/post/getting-started-with-ttrpc/" />


<link rel="stylesheet" href="https://alleeclark.github.io/assets/style.css">


<link rel="stylesheet" href="https://alleeclark.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://alleeclark.github.io/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://alleeclark.github.io/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Getting started with ttrpc"/>
<meta name="twitter:description" content="I believe ttrpc stands for teeny tiny rpc. Don&#39;t quote me on it. Created for low latency environments based off of the famous gRPC. I was introduced by ttrpc in a talk given by a containerD maintainer. Unexpected for you to know how containerD functions to get started with ttrpc.
This guide is aimed for developers who know gRPC and would like to get started with ttrpc. Knowledge of gRPC isn&#39;t required, however knowledge of golang and tcp is needed."/>



<meta property="og:title" content="Getting started with ttrpc" />
<meta property="og:description" content="I believe ttrpc stands for teeny tiny rpc. Don&#39;t quote me on it. Created for low latency environments based off of the famous gRPC. I was introduced by ttrpc in a talk given by a containerD maintainer. Unexpected for you to know how containerD functions to get started with ttrpc.
This guide is aimed for developers who know gRPC and would like to get started with ttrpc. Knowledge of gRPC isn&#39;t required, however knowledge of golang and tcp is needed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://alleeclark.github.io/post/getting-started-with-ttrpc/" />
<meta property="article:published_time" content="2019-08-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-08-25T00:00:00+00:00" /><meta property="og:site_name" content="//allee" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">//allee</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/archive">Showcase</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/archive">Showcase</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="https://alleeclark.github.io/post/getting-started-with-ttrpc/">Getting started with ttrpc</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-08-25
        </span>
      
      <span class="post-author">— Written by Allee Clark</span>
      
        <span class="post-read-time">— 3 min read</span>
      
    </div>

    

    

    <div class="post-content">
      <p>I believe ttrpc stands for teeny tiny rpc. Don't quote me on it. Created for low latency environments based off of the famous <a href="https://grpc.io/">gRPC</a>. I was introduced by ttrpc in a talk given by a <a href="https://github.com/containerd">containerD</a> maintainer. Unexpected for you to know how containerD functions to get started with ttrpc.</p>
<p>This guide is aimed for developers who know gRPC and would like to get started with ttrpc. Knowledge of gRPC isn't required, however knowledge of golang and tcp is needed. I will felish out more of this tutorial for newbies to the rpc space soon.</p>
<p>Important to note. ttrpc does sacrifice security features to reduce latency. I would not recommend opening up a ttrpc service to the world or external facing clients. I think it’s perfect for <a href="https://whatis.techtarget.com/definition/air-gapping">air gapped environments</a> or already trusted inter service communication like a cache that runs in/with your service.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li><a href="https://golang.org/">Golang</a> gRPC requires 1.6 or higher</li>
<li><a href="https://developers.google.com/protocol-buffers/">Protoc</a></li>
</ul>
<p>Make sure you have gRPC installed</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ go get -u google.golang.org/grpc
</code></pre></div><p>Also the protoc plugin for Go</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ go get -u github.com/golang/protobuf/protoc-gen-go
</code></pre></div><p><a href="https://grpc.io/docs/quickstart/go/">A thought out guide</a></p>
<p>Next you will need to install ttrpc plugin for protoc</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ go get github.com/containerd/ttrpc
$ cd $GOPATH/src/github.com/containerd/ttrpc/cmd/protoc-gen-gogottrpc/ 
$ go install
// verify the binary is $GOBIN
$ ls $GOBIN
// you should see <span style="color:#e6db74">&#39;protoc-gen-gogottrpc&#39;</span> in stdout
</code></pre></div><p>Next create a package in your Go workspace</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mkdir $GOPATH/src/ttrpc-demo
$ cd $GOPATH/src/ttrpc-demo
</code></pre></div><p>We'll create a folder titled &lsquo;pb&rsquo; to write our proto files in</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mkdir pb
$ cd pb
</code></pre></div><p>Create a file titled hello.proto
in the contents fo the file put</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-proto" data-lang="proto">syntax <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;proto3&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">option</span> go_package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello;hello&#34;</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">service</span> HelloService{<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">rpc</span> HelloWorld(HelloRequest) <span style="color:#66d9ef">returns</span> (HelloResponse);<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">HelloRequest</span>{<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">string</span> msg <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">message</span> <span style="color:#a6e22e">HelloResponse</span>{<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">string</span> response <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Now we need to generate our code using the ttrpc plugin we installed earlier. This will create a new directory titled hello with generated code for your service.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ protoc -I ../pb/ --gogottrpc_out<span style="color:#f92672">=</span>plugins<span style="color:#f92672">=</span>ttrpc:../pb ../pb/*.proto
</code></pre></div><p>Lets write some server side code. Create a new directory titled server/ttrpc/ and a file titled server.go</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mkdir -p $GOPATH/src/ttrpc-demo/server/ttrpc
$ touch $GOPATH/src/ttrpc-demo/server/ttrpc/server.go
</code></pre></div><p>In the server.go file, lets write our service calls</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;context&#34;</span>
	<span style="color:#e6db74">&#34;errors&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;net&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;ttrpc-demo/pb/hello&#34;</span>

	<span style="color:#e6db74">&#34;github.com/containerd/ttrpc&#34;</span>
)

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">port</span> = <span style="color:#e6db74">&#34;:9000&#34;</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {

	<span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ttrpc</span>.<span style="color:#a6e22e">NewServer</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#a6e22e">err</span>)
		<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
	}
	<span style="color:#a6e22e">lis</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#a6e22e">port</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#a6e22e">err</span>)
		<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
	}
	<span style="color:#a6e22e">hello</span>.<span style="color:#a6e22e">RegisterHelloServiceService</span>(<span style="color:#a6e22e">s</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">helloService</span>{})
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Serve</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">lis</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#a6e22e">err</span>)
	}
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">helloService</span> <span style="color:#66d9ef">struct</span>{}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#a6e22e">helloService</span>) <span style="color:#a6e22e">HelloWorld</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">hello</span>.<span style="color:#a6e22e">HelloRequest</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">hello</span>.<span style="color:#a6e22e">HelloResponse</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Msg</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;ErrNoInputMsgGiven&#34;</span>)
	}
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">hello</span>.<span style="color:#a6e22e">HelloResponse</span>{<span style="color:#a6e22e">Response</span>: <span style="color:#e6db74">&#34;Hi How are you&#34;</span>}, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>Now lets generate our client side code. Let's create a new directory and a client.go file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mkdir -p $GOPATH/src/ttrpc-demo/client/ttrpc/
$ touch $GOPATH/src/ttrpc-demo/client/ttrpc/client.go
</code></pre></div><p>Inside client.go &ndash; place contents below</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;context&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;net&#34;</span>
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;ttrpc-demo/pb/hello&#34;</span>

	<span style="color:#e6db74">&#34;github.com/containerd/ttrpc&#34;</span>
)

<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">port</span> = <span style="color:#e6db74">&#34;:9001&#34;</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Dial</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#a6e22e">port</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#e6db74">&#34;Failed to dial: %v \n&#34;</span>, <span style="color:#a6e22e">err</span>)
		<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
	}
	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">hello</span>.<span style="color:#a6e22e">NewHelloServiceClient</span>(<span style="color:#a6e22e">ttrpc</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">conn</span>))
	<span style="color:#a6e22e">serverResponse</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">HelloWorld</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">hello</span>.<span style="color:#a6e22e">HelloRequest</span>{
		<span style="color:#a6e22e">Msg</span>: <span style="color:#e6db74">&#34;Hello Server&#34;</span>,
	})
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#a6e22e">err</span>)
		<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Exit</span>(<span style="color:#ae81ff">1</span>)
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">serverResponse</span>.<span style="color:#a6e22e">Response</span>)
}
</code></pre></div>
    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://alleeclark.github.io/post/antipatterns-in-sre/">
                <span class="button__icon">←</span>
                <span class="button__text">One SRE’s Struggle and Success to Improve Infrastructure as Code</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://alleeclark.github.io/post/vscode-tips-tricks-1/">
                <span class="button__text">VSCode Productivity Tips &amp; Tricks</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">//allee</span>
    <span class="logo__cursor"></span>
  
</a>

    
  </div>
</footer>

<script src="https://alleeclark.github.io/assets/main.js"></script>
<script src="https://alleeclark.github.io/assets/prism.js"></script>
<footer class="container text-center">
    <p><a href="https://www.linkedin.com/in/alleexyz/" target="_blank">Linkedin</a> | <a href="https://twitter.com/alleeclark" target="_blank">Twitter</a> | <a href="https://github.com/alleeclark" target="_blank">Github</a></p>
    <small> <a href="/">//allee</a> </small>
</footer>

      
    </div>

    
  </body>
</html>
