<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Getting started with ttrpc :: //allee</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="I believe ttrpc stands for teeny tiny rpc. Don&amp;rsquo;t quote me on it. Created for low latency environments based off of the famous gRPC. I was introduced by ttrpc in a talk given by a containerD maintainer. Unexpected for you to know how containerD functions to get started with ttrpc.
This guide is aimed for developers who know gRPC and would like to get started with ttrpc. Knowledge of gRPC isn&amp;rsquo;t required, however knowledge of golang and tcp is needed."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://alleeclark.github.io/post/getting-started-with-ttrpc/" />


<link rel="stylesheet" href="https://alleeclark.github.io/assets/style.css">


<link rel="stylesheet" href="https://alleeclark.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://alleeclark.github.io/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://alleeclark.github.io/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Getting started with ttrpc"/>
<meta name="twitter:description" content="I believe ttrpc stands for teeny tiny rpc. Don&rsquo;t quote me on it. Created for low latency environments based off of the famous gRPC. I was introduced by ttrpc in a talk given by a containerD maintainer. Unexpected for you to know how containerD functions to get started with ttrpc.
This guide is aimed for developers who know gRPC and would like to get started with ttrpc. Knowledge of gRPC isn&rsquo;t required, however knowledge of golang and tcp is needed."/>



<meta property="og:title" content="Getting started with ttrpc" />
<meta property="og:description" content="I believe ttrpc stands for teeny tiny rpc. Don&rsquo;t quote me on it. Created for low latency environments based off of the famous gRPC. I was introduced by ttrpc in a talk given by a containerD maintainer. Unexpected for you to know how containerD functions to get started with ttrpc.
This guide is aimed for developers who know gRPC and would like to get started with ttrpc. Knowledge of gRPC isn&rsquo;t required, however knowledge of golang and tcp is needed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://alleeclark.github.io/post/getting-started-with-ttrpc/" />
<meta property="article:published_time" content="2019-08-25T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-08-25T00:00:00&#43;00:00"/><meta property="og:site_name" content="//allee" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">//allee</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/post">Showcase</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/post">Showcase</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="https://alleeclark.github.io/post/getting-started-with-ttrpc/">Getting started with ttrpc</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-08-25
        </span>
      
      <span class="post-author">— Written by Allee Clark</span>
      
        <span class="post-read-time">— 3 min read</span>
      
    </div>

    

    

    <div class="post-content">
      

<p>I believe ttrpc stands for teeny tiny rpc. Don&rsquo;t quote me on it. Created for low latency environments based off of the famous <a href="https://grpc.io/">gRPC</a>. I was introduced by ttrpc in a talk given by a <a href="https://github.com/containerd">containerD</a> maintainer. Unexpected for you to know how containerD functions to get started with ttrpc.</p>

<p>This guide is aimed for developers who know gRPC and would like to get started with ttrpc. Knowledge of gRPC isn&rsquo;t required, however knowledge of golang and tcp is needed. I will felish out more of this tutorial for newbies to the rpc space soon.</p>

<p>Important to note. ttrpc does sacrifice security features to reduce latency. I would not recommend opening up a ttrpc service to the world or external facing clients. I think it’s perfect for <a href="https://whatis.techtarget.com/definition/air-gapping">air gapped environments</a> or already trusted inter service communication like a cache that runs in/with your service.</p>

<h2 id="requirements">Requirements</h2>

<ul>
<li><a href="https://golang.org/">Golang</a> gRPC requires 1.6 or higher</li>
<li><a href="https://developers.google.com/protocol-buffers/">Protoc</a></li>
</ul>

<p>Make sure you have gRPC installed</p>

<pre><code class="language-shell">$ go get -u google.golang.org/grpc
</code></pre>

<p>Also the protoc plugin for Go</p>

<pre><code class="language-shell">$ go get -u github.com/golang/protobuf/protoc-gen-go
</code></pre>

<p><a href="https://grpc.io/docs/quickstart/go/">A thought out guide</a></p>

<p>Next you will need to install ttrpc plugin for protoc</p>

<pre><code class="language-shell">$ go get github.com/containerd/ttrpc
$ cd $GOPATH/src/github.com/containerd/ttrpc/cmd/protoc-gen-gogottrpc/ 
$ go install
// verify the binary is $GOBIN
$ ls $GOBIN
// you should see 'protoc-gen-gogottrpc' in stdout
</code></pre>

<p>Next create a package in your Go workspace</p>

<pre><code class="language-shell">$ mkdir $GOPATH/src/ttrpc-demo
$ cd $GOPATH/src/ttrpc-demo
</code></pre>

<p>We&rsquo;ll create a folder titled &lsquo;pb&rsquo; to write our proto files in</p>

<pre><code class="language-shell">$ mkdir pb
$ cd pb
</code></pre>

<p>Create a file titled hello.proto
in the contents fo the file put</p>

<pre><code class="language-proto">syntax = &quot;proto3&quot;;

option go_package = &quot;hello;hello&quot;;

service HelloService{
    rpc HelloWorld(HelloRequest) returns (HelloResponse);
}

message HelloRequest{
    string msg = 1;
}

message HelloResponse{
    string response = 1;
}

</code></pre>

<p>Now we need to generate our code using the ttrpc plugin we installed earlier. This will create a new directory titled hello with generated code for your service.</p>

<pre><code class="language-shell">$ protoc -I ../pb/ --gogottrpc_out=plugins=ttrpc:../pb ../pb/*.proto
</code></pre>

<p>Lets write some server side code. Create a new directory titled server/ttrpc/ and a file titled server.go</p>

<pre><code class="language-shell">$ mkdir -p $GOPATH/src/ttrpc-demo/server/ttrpc
$ touch $GOPATH/src/ttrpc-demo/server/ttrpc/server.go
</code></pre>

<p>In the server.go file, lets write our service calls</p>

<pre><code class="language-go">package main

import (
	&quot;context&quot;
	&quot;errors&quot;
	&quot;fmt&quot;
	&quot;net&quot;
	&quot;os&quot;
	&quot;ttrpc-demo/pb/hello&quot;

	&quot;github.com/containerd/ttrpc&quot;
)

const port = &quot;:9000&quot;

func main() {

	s, err := ttrpc.NewServer()
	defer s.Close()
	if err != nil {
		fmt.Fprintln(os.Stderr, err)
		os.Exit(1)
	}
	lis, err := net.Listen(&quot;tcp&quot;, port)
	if err != nil {
		fmt.Fprintln(os.Stderr, err)
		os.Exit(1)
	}
	hello.RegisterHelloServiceService(s, &amp;helloService{})
	if err := s.Serve(context.Background(), lis); err != nil {
		fmt.Fprintln(os.Stderr, err)
	}
}

type helloService struct{}

func (s helloService) HelloWorld(ctx context.Context, r *hello.HelloRequest) (*hello.HelloResponse, error) {
	if r.Msg == &quot;&quot; {
		return nil, errors.New(&quot;ErrNoInputMsgGiven&quot;)
	}
	return &amp;hello.HelloResponse{Response: &quot;Hi How are you&quot;}, nil
}
</code></pre>

<p>Now lets generate our client side code. Let&rsquo;s create a new directory and a client.go file</p>

<pre><code class="language-shell">$ mkdir -p $GOPATH/src/ttrpc-demo/client/ttrpc/
$ touch $GOPATH/src/ttrpc-demo/client/ttrpc/client.go
</code></pre>

<p>Inside client.go &ndash; place contents below</p>

<pre><code class="language-go">package main

import (
	&quot;context&quot;
	&quot;fmt&quot;
	&quot;net&quot;
	&quot;os&quot;
	&quot;ttrpc-demo/pb/hello&quot;

	&quot;github.com/containerd/ttrpc&quot;
)

const port = &quot;:9001&quot;

func main() {
	conn, err := net.Dial(&quot;tcp&quot;, port)
	if err != nil {
		fmt.Fprintf(os.Stderr, &quot;Failed to dial: %v \n&quot;, err)
		os.Exit(1)
	}
	client := hello.NewHelloServiceClient(ttrpc.NewClient(conn))
	serverResponse, err := client.HelloWorld(context.Background(), &amp;hello.HelloRequest{
		Msg: &quot;Hello Server&quot;,
	})
	if err != nil {
		fmt.Fprintln(os.Stderr, err)
		os.Exit(1)
	}
	fmt.Fprintln(os.Stdout, serverResponse.Response)
}
</code></pre>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
          
            <span class="button next">
              <a href="https://alleeclark.github.io/post/upcoming-talks/">
                <span class="button__text">Upcoming talks</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">//allee</span>
    <span class="logo__cursor"></span>
  
</a>

    
  </div>
</footer>

<script src="https://alleeclark.github.io/assets/main.js"></script>
<script src="https://alleeclark.github.io/assets/prism.js"></script>
<footer class="container text-center">
    <p><a href="https://www.linkedin.com/in/alleexyz/" target="_blank">Linkedin</a> | <a href="https://twitter.com/alleeclark" target="_blank">Twitter</a> | <a href="https://github.com/alleeclark" target="_blank">Github</a></p>
    <small> <a href="/">//allee</a> </small>
</footer>

      
    </div>

    
  </body>
</html>
